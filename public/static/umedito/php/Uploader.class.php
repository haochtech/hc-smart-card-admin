<?php
 class Uploader { private $fileField; private $file; private $config; private $oriName; private $fileName; private $fullName; private $fileSize; private $fileType; private $stateInfo; private $stateMap = array("\x53\x55\x43\103\105\x53\123", "\xe6\x96\x87\344\273\xb6\xe5\244\247\345\260\x8f\xe8\xb6\x85\xe5\207\272\40\x75\x70\154\157\x61\x64\x5f\x6d\141\170\x5f\x66\x69\x6c\145\163\151\172\x65\40\351\x99\220\xe5\210\xb6", "\xe6\226\207\xe4\xbb\266\345\xa4\247\345\260\x8f\xe8\xb6\x85\xe5\207\xba\40\x4d\101\130\137\106\x49\114\105\137\123\x49\x5a\105\40\351\231\220\xe5\x88\xb6", "\346\x96\207\344\xbb\xb6\346\x9c\252\350\xa2\xab\xe5\xae\214\346\225\xb4\xe4\xb8\x8a\344\274\240", "\346\262\241\346\234\211\346\226\x87\344\273\xb6\xe8\xa2\253\xe4\270\212\xe4\274\240", "\xe4\xb8\x8a\xe4\274\xa0\346\226\207\xe4\xbb\xb6\xe4\xb8\xba\xe7\xa9\xba", "\120\x4f\x53\124" => "\346\x96\x87\344\xbb\xb6\345\xa4\xa7\345\260\x8f\350\266\x85\345\207\272\40\x70\157\163\164\x5f\155\x61\x78\137\163\151\x7a\x65\x20\xe9\231\x90\345\x88\266", "\123\111\132\105" => "\346\x96\x87\344\273\xb6\xe5\244\247\xe5\260\217\350\266\x85\345\x87\272\xe7\xbd\221\xe7\253\231\xe9\231\x90\xe5\x88\xb6", "\x54\x59\x50\105" => "\344\270\x8d\345\x85\x81\350\256\270\347\x9a\x84\xe6\226\x87\xe4\xbb\xb6\347\xb1\273\xe5\236\x8b", "\x44\x49\x52" => "\347\x9b\xae\xe5\xbd\225\345\x88\x9b\345\xbb\272\345\244\261\350\xb4\xa5", "\x49\117" => "\xe8\xbe\223\xe5\205\245\350\xbe\x93\xe5\x87\272\351\224\231\350\257\257", "\x55\x4e\x4b\x4e\x4f\x57\x4e" => "\346\x9c\xaa\347\x9f\xa5\xe9\224\x99\350\257\xaf", "\115\x4f\x56\x45" => "\xe6\226\x87\xe4\273\xb6\xe4\xbf\235\345\xad\x98\346\227\266\345\207\272\351\x94\231", "\104\111\122\x5f\x45\x52\x52\117\x52" => "\345\210\233\xe5\xbb\272\347\233\256\xe5\275\225\xe5\244\xb1\350\264\245"); public function __construct($fileField, $config, $base64 = false) { goto iJ8IK; Ky83m: $this->stateInfo = $this->stateMap[0]; goto WynGc; iJ8IK: $this->fileField = $fileField; goto x8Ij1; WynGc: $this->upFile($base64); goto CFUFy; x8Ij1: $this->config = $config; goto Ky83m; CFUFy: } private function upFile($base64) { goto YA7SI; VlszO: if (!($folder === false)) { goto HUMVA; } goto NUp2B; t60CT: u26Kz: goto Z9yBv; amppQ: $this->stateInfo = $this->getStateInfo("\120\x4f\x53\124"); goto AZ6rI; X_wo0: if ($this->checkSize()) { goto UOu0t; } goto qQFe8; e9eRw: $file = $this->file = $_FILES[$this->fileField]; goto dr6_3; AZ6rI: return; goto tBve9; a0gOe: return; goto kKxwf; OhMfo: if (is_uploaded_file($file["\x74\x6d\x70\x5f\x6e\141\155\145"])) { goto fMarv; } goto pttoL; uza2A: $this->stateInfo = $this->getStateInfo($file["\x65\162\162\x6f\x72"]); goto Y2WTk; q2hCm: fBrDE: goto ZPSSm; i0Lc2: if (!($this->stateInfo == $this->stateMap[0])) { goto fBrDE; } goto q22VD; dr6_3: if ($file) { goto MEdyt; } goto amppQ; UzQX_: $this->stateInfo = $this->getStateInfo("\115\x4f\126\x45"); goto ldR6x; tEJQ9: $this->stateInfo = $this->getStateInfo("\124\x59\x50\x45"); goto RXnYV; NUp2B: $this->stateInfo = $this->getStateInfo("\104\111\122\137\x45\x52\x52\x4f\x52"); goto YXLpe; rzz15: $this->base64ToImage($content); goto HzWGm; H5eqn: if (!$this->file["\145\162\x72\x6f\x72"]) { goto DGl2S; } goto uza2A; YXLpe: return; goto fJeR6; Z5XRU: $content = $_POST[$this->fileField]; goto rzz15; s7qXL: KoONr: goto e9eRw; uL03Q: $this->oriName = $file["\x6e\x61\155\x65"]; goto l5_tC; l5_tC: $this->fileSize = $file["\163\151\172\145"]; goto fpmJ0; aSIYe: DGl2S: goto OhMfo; qQFe8: $this->stateInfo = $this->getStateInfo("\123\111\132\x45"); goto xNaJQ; YA7SI: if (!("\x62\141\163\x65\x36\x34" == $base64)) { goto KoONr; } goto Z5XRU; xNaJQ: return; goto zahJW; RXnYV: return; goto t60CT; HzWGm: return; goto s7qXL; kKxwf: fMarv: goto uL03Q; tBve9: MEdyt: goto H5eqn; fpmJ0: $this->fileType = $this->getFileExt(); goto X_wo0; fJeR6: HUMVA: goto Ta8zf; zahJW: UOu0t: goto Ablkw; ldR6x: SqGNN: goto q2hCm; pttoL: $this->stateInfo = $this->getStateInfo("\125\x4e\113\x4e\117\x57\116"); goto a0gOe; Ablkw: if ($this->checkType()) { goto u26Kz; } goto tEJQ9; Z9yBv: $folder = $this->getFolder(); goto VlszO; Y2WTk: return; goto aSIYe; Ta8zf: $this->fullName = $folder . "\x2f" . $this->getName(); goto i0Lc2; q22VD: if (move_uploaded_file($file["\x74\155\160\137\x6e\x61\155\x65"], $this->fullName)) { goto SqGNN; } goto UzQX_; ZPSSm: } private function base64ToImage($base64Data) { goto haQwE; lOCw8: $this->fileSize = strlen($img); goto f5_IE; JAE9c: $this->fileName = time() . rand(1, 10000) . "\56\160\156\x67"; goto w_1Zu; owZSf: $this->oriName = ''; goto lOCw8; XnFYk: WIGtA: goto owZSf; haQwE: $img = base64_decode($base64Data); goto JAE9c; E_1t0: $this->stateInfo = $this->getStateInfo("\x49\117"); goto qSOEP; yget3: if (file_put_contents($this->fullName, $img)) { goto WIGtA; } goto E_1t0; qSOEP: return; goto XnFYk; w_1Zu: $this->fullName = $this->getFolder() . "\57" . $this->fileName; goto yget3; f5_IE: $this->fileType = "\56\x70\156\x67"; goto OUTLU; OUTLU: } public function getFileInfo() { return array("\x6f\x72\151\147\x69\x6e\x61\x6c\116\x61\155\x65" => $this->oriName, "\156\141\x6d\145" => $this->fileName, "\x75\162\x6c" => $this->fullName, "\163\151\x7a\x65" => $this->fileSize, "\x74\171\160\145" => $this->fileType, "\x73\164\x61\x74\x65" => $this->stateInfo); } private function getStateInfo($errCode) { return !$this->stateMap[$errCode] ? $this->stateMap["\x55\116\113\x4e\117\x57\x4e"] : $this->stateMap[$errCode]; } private function getName() { return $this->fileName = time() . rand(1, 10000) . $this->getFileExt(); } private function checkType() { return in_array($this->getFileExt(), $this->config["\141\x6c\x6c\157\x77\106\x69\x6c\145\163"]); } private function checkSize() { return $this->fileSize <= $this->config["\x6d\141\170\x53\x69\x7a\145"] * 1024; } private function getFileExt() { return strtolower(strrchr($this->file["\156\141\155\x65"], "\56")); } private function getFolder() { goto Q2vW0; aEAVU: $pathStr .= "\57"; goto F7iAq; THBsE: if (mkdir($pathStr, 0777, true)) { goto Iec3e; } goto BdWV1; PGfdf: if (!(strrchr($pathStr, "\x2f") != "\57")) { goto pS1AZ; } goto aEAVU; W_GLh: if (file_exists($pathStr)) { goto LxurM; } goto THBsE; F7iAq: pS1AZ: goto OMhki; BdWV1: return false; goto UOngP; UOngP: Iec3e: goto RPh74; RPh74: LxurM: goto ug343; OMhki: $pathStr .= date("\x59\x6d\x64"); goto W_GLh; Q2vW0: $pathStr = $this->config["\163\141\x76\x65\120\x61\164\150"]; goto PGfdf; ug343: return $pathStr; goto MIdKG; MIdKG: } }
